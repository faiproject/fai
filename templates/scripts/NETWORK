#! /usr/bin/cfengine
##############################################################
#
# cf.network - for informatik.uni-koeln.de
#
#################################################################

control:

   OutputPrefix = ("${cf_prefix}")

   actionsequence  = ( 
		     files
                     copy
		     editfiles
                     )

files:
   REMOTE_PRINTER.NET_9::
        ${target}/var/spool/lpd/${printers}/. m=755 o=lp g=lp action=touch

copy:
   NET_9::
	${files}/etc/hosts/NET_9	dest=${target}/etc/hosts
           m=644 o=root g=root  
	   force=${force} backup=${backup}

	${files}/etc/hosts.equiv/NET_9	dest=${target}/etc/hosts.equiv
           m=644 o=root g=root  
	   force=${force} backup=${backup}

	${files}/root/.rhosts/NET_9	dest=${target}/root/.rhosts
           m=400 o=root g=root  
	   force=${force} backup=${backup}

	${files}/etc/hosts.allow/NET_9	dest=${target}/etc/hosts.allow
           m=644 o=root g=root  
	   force=${force} backup=${backup}

	${files}/etc/hosts.deny/NET_9	dest=${target}/etc/hosts.deny
           m=644 o=root g=root  
	   force=${force} backup=${backup}

   REMOTE_PRINTER.NET_9::
	${files}/etc/printcap/NET_9	dest=${target}/etc/printcap
           m=644 o=root g=root  
	   force=${force} backup=${backup}

editfiles:
   any::
	# root login also allowed
#	{ ${target}/etc/pam.d/login
#	  HashCommentLinesContaining "pam_securetty.so"
#	}

	{ ${target}/etc/inetd.conf
	  HashCommentLinesContaining "in.fingerd"
	  HashCommentLinesContaining "in.talkd"
	  HashCommentLinesContaining "in.ntalkd"
	  HashCommentLinesContaining "in.rexecd"
	  HashCommentLinesContaining "discard"
	  HashCommentLinesContaining "daytime"
	  HashCommentLinesContaining "identd"
	  SetCommentStart	 "#"
	  SetCommentEnd		 ""
	}

	{ ${target}/etc/networks
	  AutoCreate
	  EmptyEntireFilePlease
	  Append 	"localnet ${NETWORK}"
	}

	{ ${target}/etc/network/interfaces
	  AutoCreate
	  EmptyEntireFilePlease
	  Append 	'# generated by FAI'
	  Append	'iface lo inet static'
	  Append	'address 127.0.0.1'
	  Append	'netmask 255.0.0.0'
	  Append	'iface eth0 inet static'
	  Append	'address ${IPADDR}'
	  Append	'netmask ${NETMASK}'
	  Append	'broadcast ${BROADCAST}'
	  Append	'gateway ${GATEWAYS}'
	}

   NET_9::
	# no tcpd for several services,
	{ ${target}/etc/inetd.conf
	  ReplaceAll "/usr/sbin/tcpd.+/usr/sbin/in.rshd"
		With "/usr/sbin/in.rshd${tab}in.rshd"
	  ReplaceAll "/usr/sbin/tcpd.+/usr/sbin/in.rlogind"
		With "/usr/sbin/in.rlogind${tab}in.rlogind"
	  ReplaceAll "/usr/sbin/tcpd.+/usr/sbin/rpc.rstatd" 
		With "/usr/sbin/rpc.rstatd${tab}rpc.rstatd"
	  ReplaceAll "/usr/sbin/tcpd.+/usr/sbin/rpc.rusersd" 
		With "/usr/sbin/rpc.rusersd${tab}rpc.rusersd"
	}

   SERVER::
	{ ${target}/etc/shells
	  AppendIfNoSuchLine "/usr/bin/tcsh"
	  AppendIfNoSuchLine "/usr/local/bin/tcsh"
	}	  

   NTP::
	{ ${target}/etc/ntp.conf
	  AutoCreate
	  EmptyEntireFilePlease
	  AppendIfNoSuchLine "logfile /var/log/ntpd"
	  AppendIfNoSuchLine "driftfile /var/lib/ntp/ntp.drift"
	  AppendIfNoSuchLine "broadcastclient yes"
	  AppendIfNoSuchLine "#server ${NTPSRVS_1}"
	  AppendIfNoSuchLine "#server ${NTPSRVS_2}"
	}
